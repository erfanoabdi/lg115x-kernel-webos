/*
 * LG115X MMC/SD/SDIO driver
 *
 *  Originally based on code by:
 * Copyright (C) Giuseppe Cavallaro <peppe.cavallaro@xxxxxx>
 *
 *	Modified for lg1152 
 * by Chanho Min (chanho.min@lge.com)

 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#ifndef __SDHCI_LG115X_H
#define __SDHCI_LG115X_H

#define SDHCI_LG115X_CLOCKRATE_MAX   198000000

#define SDHCI_LG115X_DRIVER_NAME	"sdhci-lg115x"
#define SDHCI_LG115X_DMA_DESC_NUM	128

/*
 * Register offsets
 */
#define SDHCI_LG115X_SDMA_SYS_ADDR		0x000
#define SDHCI_LG115X_BLK_SIZE			0x004
#define SDHCI_LG115X_BLK_COUNT		0x006
#define SDHCI_LG115X_ARG			0x008
#define SDHCI_LG115X_XFER_MODE		0x00c
#define SDHCI_LG115X_CMD			0x00e
#define SDHCI_LG115X_RSP(i)			(0x010 + ((i)<<2))
#define SDHCI_LG115X_RSP0			0x010
#define SDHCI_LG115X_RSP1			0x012
#define SDHCI_LG115X_RSP2			0x014
#define SDHCI_LG115X_RSP3			0x016
#define SDHCI_LG115X_RSP4			0x018
#define SDHCI_LG115X_RSP5			0x01a
#define SDHCI_LG115X_RSP6			0x01c
#define SDHCI_LG115X_RSP7			0x01e
#define SDHCI_LG115X_BUFF			0x020
#define SDHCI_LG115X_PRESENT_STATE		0x024
#define SDHCI_LG115X_HOST_CTRL		0x028
#define SDHCI_LG115X_HOST_CTRL2		0x03e

#define SDHCI_LG115X_PWR_CTRL			0x029
#define SDHCI_LG115X_GAP_CTRL			0x02a
#define SDHCI_LG115X_GAP_WAKEUP		0x02b
#define SDHCI_LG115X_CLOCK_CTRL		0x02c
#define SDHCI_LG115X_TIMEOUT_CTRL		0x02e
#define SDHCI_LG115X_SW_RESET			0x02f

#define SDHCI_LG115X_NORMAL_INT_STATUS	0x030
#define SDHCI_LG115X_ERR_INT_STATUS		0x032
#define SDHCI_LG115X_NORMAL_INT_STATUS_EN	0x034
#define SDHCI_LG115X_ERR_INT_STATUS_EN	0x036
#define SDHCI_LG115X_NORMAL_INT_SIGN_EN	0x038
#define SDHCI_LG115X_ERR_INT_SIGN_EN		0x03a

#define SDHCI_LG115X_CMD12_ERR_STATUS		0x03c

#define SDHCI_LG115X_CAPABILITIES		0x040

#define SDHCI_LG115X_ADMA_ERR_STATUS		0x054
#define SDHCI_LG115X_ADMA_ADDRESS		0x058

#define SDHCI_LG115X_SPI_INT_SUPPORT		0x0f0
#define SDHCI_LG115X_HOST_VERSION		0x0fe

/* Error Interrupt Status Register */
#define SDHCI_LG115X_CMD_TIMEOUT		(1 << 0)
#define SDHCI_LG115X_CMD_CRC_ERROR		(1 << 1)
#define SDHCI_LG115X_CMD_END_BIT_ERROR	(1 << 2)
#define SDHCI_LG115X_CMD_INDEX_ERROR		(1 << 3)
#define SDHCI_LG115X_DATA_TIMEOUT_ERROR	(1 << 4)
#define SDHCI_LG115X_DATA_CRC_ERROR		(1 << 5)
#define SDHCI_LG115X_DATA_END_ERROR		(1 << 6)
#define SDHCI_LG115X_CURRENT_LIMIT_ERROR	(1 << 7)
#define SDHCI_LG115X_AUTO_CMD12_ERROR		(1 << 8)
#define SDHCI_LG115X_ADMA_ERROR		(1 << 9)
#define SDHCI_LG115X_TARGET_RESP_ERROR	(1 << 12)
#define SDHCI_LG115X_CEATA_ERROR		(1 << 13)

/* Error Interrupt Status ENABLE reg. (0- Masked, 1: Enabled) */
#define SDHCI_LG115X_E_EN_CMD_TIMEOUT		(1 << 0)
#define SDHCI_LG115X_E_EN_CMD_CRC_ERROR	(1 << 1)
#define SDHCI_LG115X_E_EN_CMD_END_BIT_ERROR	(1 << 2)
#define SDHCI_LG115X_E_EN_CMD_INDEX_ERROR	(1 << 3)
#define SDHCI_LG115X_E_EN_DATA_TIMEOUT_ERROR	(1 << 4)
#define SDHCI_LG115X_E_EN_DATA_CRC_ERROR	(1 << 5)
#define SDHCI_LG115X_E_EN_DATA_END_ERROR	(1 << 6)
#define SDHCI_LG115X_E_EN_CURRENT_LIMIT_ERROR	(1 << 7)
#define SDHCI_LG115X_E_EN_AUTO_CMD12_ERROR	(1 << 8)
#define SDHCI_LG115X_E_EN_ADMA_ERROR		(1 << 9)
#define SDHCI_LG115X_E_EN_TARGET_RESP_ERROR	(1 << 12)
#define SDHCI_LG115X_E_EN_CEATA_ERROR		(1 << 13)

/* Normal Interrupt Status Register */
#define SDHCI_LG115X_N_CMD_COMPLETE		(1 << 0)
#define SDHCI_LG115X_N_TRANS_COMPLETE		(1 << 1)
#define SDHCI_LG115X_N_BLK_GAP_EVENT		(1 << 2)
#define SDHCI_LG115X_N_DMA_IRQ		(1 << 3)
#define SDHCI_LG115X_N_BUFF_WRITE		(1 << 4)
#define SDHCI_LG115X_N_BUFF_READ		(1 << 5)
#define SDHCI_LG115X_N_CARD_INS		(1 << 6)
#define SDHCI_LG115X_N_CARD_REMOVAL		(1 << 7)
#define SDHCI_LG115X_N_CARD_IRQ		(1 << 8)
#define SDHCI_LG115X_N_ERROR_IRQ		(1 << 15)

/* Normal Interrupt Status ENABLE reg. (0- Masked, 1: Enabled) */
#define SDHCI_LG115X_N_EN_CMD_COMPLETE	(1 << 0)
#define SDHCI_LG115X_N_EN_TRANS_COMPL		(1 << 1)
#define SDHCI_LG115X_N_EN_BLOCK_GAP		(1 << 2)
#define SDHCI_LG115X_N_EN_DMA_IRQ		(1 << 3)
#define SDHCI_LG115X_N_EN_BUFF_WRITE		(1 << 4)
#define SDHCI_LG115X_N_EN_BUFF_READ		(1 << 5)
#define SDHCI_LG115X_N_EN_CARD_INS		(1 << 6)
#define SDHCI_LG115X_N_EN_CARD_REM		(1 << 7)
#define SDHCI_LG115X_N_EN_CARD_IRQ		(1 << 8)

/* Default Enable Normal/Error interrupt mask */
#define SDHCI_LG115X_IRQ_DEFAULT_MASK		0x02ff00fb
//#define SDHCI_LG115X_IRQ_DEFAULT_MASK		0x01ff0efb //NEX_DBG

/* Mask normal and error fields */
#define SDHCI_LG115X_INT_DATA_MASK		0x0070003a
#define SDHCI_LG115X_INT_CMD_MASK		0x000f0001

/* Command Register */
#define SDHCI_LG115X_CMD_RSP_NONE		(0 << 0)
#define SDHCI_LG115X_CMD_RSP_136		(1 << 0)
#define SDHCI_LG115X_CMD_RSP_48		(2 << 0)
#define SDHCI_LG115X_CMD_RSP_48BUSY		(3 << 0)
#define SDHCI_LG115X_CMD_CHECK_CMDCRC		(1 << 3)
#define SDHCI_LG115X_CMD_INDX_CHECK		(1 << 4)
#define SDHCI_LG115X_CMD_DATA_PRESENT		(1 << 5)
#define SDHCI_LG115X_COMMAD_TYPE_NORM		(0 << 6)
#define SDHCI_LG115X_COMMAD_TYPE_SUSP		(1 << 6)
#define SDHCI_LG115X_COMMAD_TYPE_RESU		(2 << 6)
#define SDHCI_LG115X_COMMAD_TYPE_ABOR		(3 << 6)
#define SDHCI_LG115X_CMD_INDEX(x)		((x) << 8)

/* Transfer Mode Register */
#define SDHCI_LG115X_XFER_DMA_EN		(1 << 0)
#define SDHCI_LG115X_XFER_BLK_COUNT_EN	(1 << 1)
#define SDHCI_LG115X_XFER_AUTOCMD12		(1 << 2)	/* 1: Enable */
#define SDHCI_LG115X_XFER_DATA_DIR		(1 << 4)	/* 0: Write, 1: Read */
#define SDHCI_LG115X_XFER_MULTI_BLK		(1 << 5)	/* 0: Single 1: Multi */
#define SDHCI_LG115X_XFER_SPI_MODE		(1 << 7)	/* 1: SPI 0: SD Mode */

enum xfer_dat_cmd_status {
	STATE_CMD = 0,
	STATE_DATA_WRITE = 1,
	STATE_DATA_READ = 2,
	STATE_DATA_STOP = 2,
};

/* Software Reset */
#define SDHCI_LG115X_RESET_ALL			0x1
#define SDHCI_LG115X_RESET_CMD_LINE		0x2
#define SDHCI_LG115X_RESET_DAT_LINE		0x4

enum sw_reset_cmd {
	reset_all = 0,
	reset_cmd_line = 1,
	reset_dat_line = 2,
};

/* Host Control Register */
#define SDHCI_LG115X_HOST_CTRL_LED		(1 << 0)
#define SDHCI_LG115X_HOST_CTRL_SD		(1 << 1)	/* 1: 4 bit mode */
#define SDHCI_LG115X_HOST_CTRL_HIGH_SPEED	(1 << 2)
#define SDHCI_LG115X_HOST_CTRL_SDMA_SEL	(0 << 3)
#define SDHCI_LG115X_HOST_CTRL_ADMA1		(1 << 3)
#define SDHCI_LG115X_HOST_CTRL_ADMA2_32	(2 << 3)
#define SDHCI_LG115X_HOST_CTRL_ADMA2_64	(3 << 3)
#define SDHCI_LG115X_HOST_CTRL_SD8		(1 << 5)
#define SDHCI_LG115X_HOST_CTRL_CARD_LEV_TEST	(1 << 6)
#define SDHCI_LG115X_HOST_CTRL_CARD_SIG_TEST	(1 << 7)

#define SDHCI_LG115X_HOST_CTRL_SD_MASK	0x22

/* Clock Control Register */
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_MASK	0xff00
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_SHIFT	8
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_256	0x8000
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_128	0x4000
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_64	0x2000
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_32	0x1000
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_16	0x0800
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_8	0x0400
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_4	0x0200
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_2	0x0100
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_1	0x0000
#define SDHCI_LG115X_CLOCK_CTRL_SDCLK_ENABLE	(1 << 2)
#define SDHCI_LG115X_CLOCK_CTRL_ICLK_STABLE	(1 << 1)
#define SDHCI_LG115X_CLOCK_CTRL_ICLK_ENABLE	(1 << 0)

/* Power Control Register */
#define SDHCI_LG115X_PWR_CTRL_UP		(1 << 0)	/* 1: Power-On */
#define SDHCI_LG115X_PWR_BUS_VOLTAGE_33	(7 << 1)
#define SDHCI_LG115X_PWR_BUS_VOLTAGE_30	(6 << 1)
#define SDHCI_LG115X_PWR_BUS_VOLTAGE_18	(5 << 1)

/* CMD12 error status bits */
#define SDHCI_LG115X_AUTOCMD12_ERR_NOTEXE	(1 << 0)
#define SDHCI_LG115X_AUTOCMD12_ERR_TIMEOUT	(1 << 1)
#define SDHCI_LG115X_AUTOCMD12_ERR_CRC	(1 << 2)
#define SDHCI_LG115X_AUTOCMD12_ERR_ENDBIT	(1 << 3)
#define SDHCI_LG115X_AUTOCMD12_ERR_INDEX	(1 << 4)
#define SDHCI_LG115X_AUTOCMD12_ERR_NOT_ISSUED	(1 << 7)

/* Present State Register */
#define SDHCI_LG115X_PRESENT_STATE_DAT7_4       0x1e000000
#define SDHCI_LG115X_PRESENT_STATE_CMD_LINE     0x01000000
#define SDHCI_LG115X_PRESENT_STATE_DAT3_0       0x00f00000
#define SDHCI_LG115X_PRESENT_STATE_WR_EN        0x00080000
#define SDHCI_LG115X_PRESENT_STATE_CARD_DETECT  0x00040000
#define SDHCI_LG115X_PRESENT_STATE_CARD_STABLE  0x00020000
#define SDHCI_LG115X_PRESENT_STATE_CARD_PRESENT 0x00010000
#define SDHCI_LG115X_PRESENT_STATE_BUFFER_RD_EN 0x00000800
#define SDHCI_LG115X_PRESENT_STATE_BUFFER_WR_EN 0x00000400
#define SDHCI_LG115X_PRESENT_STATE_RD_ACTIVE    0x00000200
#define SDHCI_LG115X_PRESENT_STATE_WR_ACTIVE    0x00000100
#define SDHCI_LG115X_PRESENT_STATE_DAT_ACTIVE   0x00000004
#define SDHCI_LG115X_PRESENT_STATE_DAT_INHIBIT  0x00000002
#define SDHCI_LG115X_PRESENT_STATE_CMD_INHIBIT  0x00000001

/* Block size register defines */
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_512KB	0x7000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_256KB	0x6000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_128KB	0x5000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_64KB	0x4000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_32KB	0x3000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_16KB	0x2000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_8KB	0x1000
#define SDHCI_LG115X_BLOCK_SIZE_SDMA_4KB	0x0000
#define SDHCI_LG115X_BLOCK_SIZE_TRANSFER	0x0fff

/* ADMA Error Status Register */
#define SDHCI_LG115X_ADMA_ERROR_LENGTH          0x04
#define SDHCI_LG115X_ADMA_ERROR_ST_TFR          0x03
#define SDHCI_LG115X_ADMA_ERROR_ST_FDS          0x01
#define SDHCI_LG115X_ADMA_ERROR_ST_STOP         0x00
#endif
